<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/head.ejs') %>
  <title>User Profile</title>
</head>
<body class="d-flex flex-column min-vh-100">
  <%- include('./partials/nav.ejs') %>

  <div class="container py-5 profile-page flex-grow-1">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <% if (success) { %>
          <div class="alert alert-success d-flex align-items-center" role="alert">
            <i class="bi bi-check-circle me-2"></i>
            Profile updated successfully.
          </div>
        <% } %>
        <% if (error) { %>
          <div class="alert alert-danger d-flex align-items-center" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <%= error %>
          </div>
        <% } %>

        <form action="/user/profile" method="post" enctype="multipart/form-data" class="row g-4">
          <div class="col-lg-4">
            <div class="profile-card h-100">
              <h5 class="profile-card-title mb-3"><i class="bi bi-person-badge me-2"></i>Your Avatar</h5>
              <div class="avatar-preview-wrapper mb-3">
                <img id="avatarPreview" src="<%= user.profileImageURL %>" alt="avatar" class="avatar-preview">
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Upload new avatar</label>
                <input type="file" class="form-control" name="avatar" accept="image/*" onchange="previewAvatar(this)">
                <div class="form-text">PNG or JPG recommended, up to 3 MB.</div>
              </div>
            </div>
          </div>

          <div class="col-lg-8">
            <div class="profile-card h-100">
              <h5 class="profile-card-title mb-3"><i class="bi bi-pencil-square me-2"></i>Your Bio</h5>
              <div class="mb-3">
                <label class="form-label fw-semibold">Name</label>
                <input type="text" class="form-control" value="<%= user.fullName %>" disabled>
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Email</label>
                <input type="email" class="form-control" value="<%= user.email %>" disabled>
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold" for="bio">Bio</label>
                <textarea class="form-control" id="bio" name="bio" rows="5" maxlength="500" placeholder="Tell others about yourself, your interests, and what you write about."><%= user.bio || '' %></textarea>
                <div class="form-text text-muted">Max 500 characters.</div>
              </div>
              <div class="d-flex justify-content-end gap-2">
                <a class="btn btn-outline-secondary" href="/">Cancel</a>
                <button class="btn btn-primary" type="submit"><i class="bi bi-save me-2"></i>Save changes</button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <%- include('./partials/scripts.ejs') %>
  <script>
    function previewAvatar(input) {
      if (!input.files || !input.files[0]) return;
      const file = input.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = document.getElementById('avatarPreview');
        if (img) img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  </script>
</body>
</html>
